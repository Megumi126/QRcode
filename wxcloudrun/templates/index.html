<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <link rel="shortcut icon"
    href="https://static-index-4gtuqm3bfa95c963-1304825656.tcloudbaseapp.com/official-website/favicon.svg"
    mce_href="https://static-index-4gtuqm3bfa95c963-1304825656.tcloudbaseapp.com/official-website/favicon.svg"
    type="image/x-icon" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  <title>欢迎使用微信云托管</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Droid Sans", "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Droid Sans Fallback", "Microsoft YaHei", sans-serif;
    }

    .title-logo {
      width: 80px;
      height: 80px;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    @media screen and (min-width:1200px) {
      body .top {
        margin-top: 105px;
      }
      body .container {
        margin-top: 0;
        margin-bottom: 272px;
      }
    }

    @media screen and (max-width:1919px) {
      body .container {
        margin-top: 0;
        margin-bottom: 128px;
      }
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .quote {
      font-size: 12px;
    }

    .qrcode {
      height: 144px;
      width: 144px;
      display: block;
      margin: 0 auto;
    }

    .title {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      width: 320px;
    }

    .title-text {
      width: 320px;
      height: 48px;
      text-align: center;
      margin-top: 16px;
      font-size: 32px;
      opacity: 0.9;
      font-weight: 500;
      font-size: 32px;
      color: #000000;
      letter-spacing: 0;
      line-height: 48px;
    }

    .counter-container {
      margin-top: 48px;
    }

    .hr {
      text-align: center;
      position: relative;
      z-index: 2;
      height: 20px;
      line-height: 20px;
    }

    .hr::after {
      position: absolute;
      content: '';
      top: 10px;
      left: 60px;
      width: 200px;
      border-bottom: 1px solid rgba(0, 0, 0, .1);
      z-index: -1;
    }

    .hr small {
      display: inline-block;
      background-color: white;
    }

    .hr-text {
      display: inline-block;
      height: 20px;
      font-weight: 400;
      font-size: 14px;
      color: rgba(0, 0, 0, 0.55);
      letter-spacing: 0;
      text-align: center;
      z-index: 2;
      background-color: white;
      padding: 0 8px;
      line-height: 20px;
    }

    .link-button {
      width: 154px;
      height: 48px;
      box-sizing: border-box;
      font-weight: 400;
      font-size: 14px;
      color: rgba(0, 0, 0, 0.90);
      letter-spacing: 0;
      text-align: center;
      background: rgba(0, 0, 0, 0.03);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card {
      margin-top: 16px;
      width: 320px;
      height: 200px;
      box-sizing: border-box;
      border: 1px solid rgba(0, 0, 0, 0.10);
      border-radius: 5.71px;
      position: relative;
    }

    .card-text {
      text-align: center;
      font-weight: 400;
      font-size: 14px;
      color: rgba(0, 0, 0, 0.55);
      letter-spacing: 0;
    }

    .scan-card {
      width: 100%;
      max-width: 720px;
      margin: 16px auto 48px;
      padding: 16px;
      border: 1px solid rgba(0, 0, 0, 0.10);
      border-radius: 8px;
    }

    .scan-actions {
      display: flex;
      gap: 12px;
      margin-top: 12px;
      justify-content: center;
    }

    .scan-result {
      margin-top: 12px;
      font-size: 14px;
      color: rgba(0, 0, 0, 0.7);
      word-break: break-all;
    }

    #qr-reader {
      width: 100%;
      min-height: 220px;
      border: 1px dashed rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(0, 0, 0, 0.45);
      font-size: 13px;
    }

    .top {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 21px;
      margin-bottom: 20px;
    }
    .alert {
      font-size: 14px;
      color: rgba(0, 0, 0, 0.55);
      border: 1px solid #f2f4f8;
      background: #f2f4f8;
      padding: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 0;
    }
    .alert-icon {
      flex-shrink: 0;
      flex-grow: 0;
      color: #c04100;
    }
    .crud-title {
      font-weight: 600;
      margin-bottom: 8px;
    }
    .crud-grid {
      display: grid;
      grid-template-columns: 1.6fr 0.8fr auto;
      gap: 8px;
      align-items: end;
    }
    .crud-field label {
      font-size: 12px;
      margin-bottom: 4px;
      color: rgba(0,0,0,0.7);
    }
    .crud-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }
    .crud-table {
      margin-top: 8px;
    }
    .help-text {
      font-size: 12px;
      color: rgba(0,0,0,0.55);
      margin-top: 6px;
    }
  </style>
</head>

<body>
  <div class="top">
    <div class="alert">
      <svg id="error-circle" class="alert-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g fill="none"><g clip-path="url(#clip0_19498_602)"><path d="M8.00016 2.00002C11.3139 2.00002 14.0002 4.68631 14.0002 8.00002C14.0002 11.3137 11.3139 14 8.00016 14C4.68646 14 2.00016 11.3137 2.00016 8.00002C2.00016 4.68631 4.68645 2.00002 8.00016 2.00002ZM15.3335 8.00002C15.3335 3.94993 12.0503 0.666687 8.00016 0.666688C3.95008 0.666688 0.66683 3.94993 0.666831 8.00002C0.666831 12.0501 3.95008 15.3334 8.00016 15.3334C12.0503 15.3334 15.3335 12.0501 15.3335 8.00002ZM7.3335 4.33335L7.3335 9.33335L8.66683 9.33335L8.66683 4.33335L7.3335 4.33335ZM8.66683 10.3334L7.33089 10.3334L7.33089 11.6693L8.66683 11.6693L8.66683 10.3334Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" fill-opacity="0.9"></path></g><defs><clipPath id="clip0_19498_602"><rect width="16" height="16" fill="white"></rect></clipPath></defs></g></svg>
      <span>默认域名仅支持测试使用，服务上线生产请绑定自定义域名；测试期间默认域名浏览器操作有有效时间，过期后需手动续期。</span>
    </div>
  </div>
  <div class="container">
    <div class="title">
      <img class="title-logo"
        src="https://static-index-4gtuqm3bfa95c963-1304825656.tcloudbaseapp.com/official-website/favicon.svg" />
      <div style="display: inline; margin-bottom: 24px" class="title-text">防伪码后端测试控制台</div>
    </div>
    <div style="text-align: center; display: flex; flex-direction: column; align-items: center; margin: 0; width: 100%; padding: 0 12px; box-sizing: border-box;">
      <div class="scan-card">
        <div style="font-weight: 500; margin-bottom: 8px;">防伪接口测试（/api/antifake/verify）</div>
        <div style="display:flex; flex-direction:column; gap:8px;">
          <input id="test-code" class="form-control form-control-sm" placeholder="16位防伪码 code" />
          <input id="test-scan-time" class="form-control form-control-sm" placeholder="YYYY/MM/DD HH:mm:ss（默认当前时间）" />
          <input id="test-ip" class="form-control form-control-sm" placeholder="客户端IP（字符串）" />
          <div style="display:flex; gap:8px; justify-content:center; margin-top:4px;">
            <button class="btn btn-success btn-sm" style="background:#07c160; border:0" onclick="callVerify()">调用验证</button>
            <button class="btn btn-outline-secondary btn-sm" onclick="fillNow()">填入当前时间</button>
          </div>
          <div class="scan-result">
            <div>返回状态：<span id="test-status">-</span></div>
            <div>上次时间：<span id="test-last-time">-</span></div>
            <div>上次IP：<span id="test-last-ip">-</span></div>
            <div>累计次数：<span id="test-count">-</span></div>
          </div>
        </div>
      </div>
      <div class="scan-card">
        <div class="crud-title">防伪码管理</div>
        <div class="crud-grid">
          <div class="crud-field">
            <label for="new-code">防伪码</label>
            <input id="new-code" class="form-control form-control-sm" placeholder="请输入16位防伪码" />
          </div>
          <div class="crud-field">
            <label for="new-is-test">测试码</label>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="new-is-test">
              <label class="form-check-label" for="new-is-test">启用</label>
            </div>
          </div>
          <div class="crud-actions">
            <button class="btn btn-primary btn-sm" onclick="addCode()">新增</button>
            <button class="btn btn-outline-secondary btn-sm" onclick="loadCodes()">刷新列表</button>
          </div>
        </div>
        <div class="help-text">操作包含：删除、切换测试状态、重置次数</div>
        <div class="crud-table">
          <table class="table table-sm table-striped table-hover align-middle">
            <thead>
              <tr>
                <th style="width:26%">防伪码</th>
                <th style="width:10%">测试</th>
                <th style="width:12%">次数</th>
                <th style="width:22%">上次时间</th>
                <th style="width:20%">上次IP</th>
                <th style="width:10%">操作</th>
              </tr>
            </thead>
            <tbody id="codes-body"></tbody>
          </table>
        </div>
      </div>
      <div>
        <div class="hr">
          <span class="hr-text">快速入门</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 16px;">
          <a class="btn btn-light btn-lg link-button" style="border: 0; box-shadow: none; margin-right: 12px;"
            href="https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/basic/intro.html" target="_blank"
            rel="noopener noreferrer">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
              height="24px" viewBox="0 0 24 24">
              <title>icons_outline_warrant copy</title>
              <g id="icons_outline_warrant-copy" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="0.&#x56FE;&#x6807;/&#x7EBF;&#x578B;/icons_outlined_copy">
                  <rect id="Rectangle" x="0" y="0" width="20" height="20"></rect>
                  <path
                    d="M13.9979043,2 L20,8 L20,21.0013542 C20,21.5542301 19.5541613,22 19.0041915,22 L5.99580851,22 C5.44892021,22 5,21.552891 5,21.0013542 L5,2.99864581 C5,2.44576991 5.44583866,2 5.99580851,2 L13.9979043,2 Z M12.399,3.2 L6.2,3.2 L6.2,20.8 L18.8,20.8 L18.8,9.6 L14,9.6 C13.1163444,9.6 12.4,8.8836556 12.4,8 L12.399,3.2 Z M14.2,14.4 L14.2,15.6 L7.8,15.6 L7.8,14.4 L14.2,14.4 Z M17.2,12 L17.2,13.2 L7.8,13.2 L7.8,12 L17.2,12 Z M13.599,3.299 L13.6,8 C13.6,8.2209139 13.7790861,8.4 14,8.4 L18.703,8.4 L13.599,3.299 Z"
                    id="Combined-Shape" fill-opacity="0.9" fill="#000000"></path>
                </g>
              </g>
            </svg>
            <span style="margin-left: 4px">开发者文档</span></a>
          <a class="btn btn-light btn-lg link-button" style="border: 0; box-shadow: none;"
            href="https://developers.weixin.qq.com/community/business/course/00068c2c0106c0667f5b01d015b80d"
            target="_blank" rel="noopener noreferrer">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
              height="24px" viewBox="0 0 24 24">
              <title>icons_outlined_play</title>
              <g id="&#x573A;&#x666F;&#x5316;&#x90E8;&#x7F72;" stroke="none" stroke-width="1" fill="none"
                fill-rule="evenodd">
                <g id="icons_outlined_play">
                  <rect id="Rectangle-664" x="0" y="0" width="20" height="20"></rect>
                  <path
                    d="M12,20.8 C16.8601058,20.8 20.8,16.8601058 20.8,12 C20.8,7.1398942 16.8601058,3.2 12,3.2 C7.1398942,3.2 3.2,7.1398942 3.2,12 C3.2,16.8601058 7.1398942,20.8 12,20.8 Z M12,22 C6.4771525,22 2,17.5228475 2,12 C2,6.4771525 6.4771525,2 12,2 C17.5228475,2 22,6.4771525 22,12 C22,17.5228475 17.5228475,22 12,22 Z M10.7,14.8349028 L15.2358445,12 L10.7,9.16509717 L10.7,14.8349028 Z M10.2649995,7.47812467 L16.8216014,11.5760008 C17.0557696,11.722356 17.1269562,12.0308312 16.980601,12.2649995 C16.9403607,12.329384 16.8859859,12.3837588 16.8216014,12.4239992 L10.2649995,16.5218753 C10.0308312,16.6682305 9.72235601,16.5970439 9.57600085,16.3628756 C9.52633472,16.2834098 9.5,16.191586 9.5,16.0978762 L9.5,7.90212382 C9.5,7.62598145 9.72385763,7.40212382 10,7.40212382 C10.0937099,7.40212382 10.1855337,7.42845854 10.2649995,7.47812467 Z"
                    id="Oval-78" fill-opacity="0.9" fill="#000000"></path>
                </g>
              </g>
            </svg>
            <span style="margin-left: 4px">视频教程</span></a>
        </div>
      </div>
    </div>
  </div>
 </body>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script>
  function pad(n){return n<10?'0'+n:n}
  function nowStr(){
    const d=new Date();
    return d.getFullYear()+'/'+pad(d.getMonth()+1)+'/'+pad(d.getDate())+' '+pad(d.getHours())+':'+pad(d.getMinutes())+':'+pad(d.getSeconds());
  }

  function fillNow(){
    $("#test-scan-time").val(nowStr());
  }
  function callVerify(){
    const code = ($("#test-code").val()||'').trim();
    const scanTime = ($("#test-scan-time").val()||'').trim() || nowStr();
    const ip = ($("#test-ip").val()||'').trim() || '1.2.3.4';
    $.ajax("/api/antifake/verify", {
      method: "POST",
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      data: JSON.stringify({code, scanTime, ip}),
    }).done(function(res){
      $("#test-status").text(res && res.status ? res.status : 'error');
      $("#test-last-time").text(res && res.lastQueryTime ? res.lastQueryTime : '-');
      $("#test-last-ip").text(res && res.lastQueryIp ? res.lastQueryIp : '-');
      $("#test-count").text(res && res.queryCount !== undefined ? res.queryCount : '-');
    }).fail(function(){
      $("#test-status").text('error');
    });
  }

  function renderCodes(list){
    const $tbody = $("#codes-body");
    $tbody.empty();
    (list||[]).forEach(function(r){
      const tr = $("<tr></tr>");
      tr.append($("<td></td>").text(r.code));
      const $badge = $('<span class="badge"></span>').addClass(r.is_test ? 'bg-warning text-dark' : 'bg-secondary').text(r.is_test ? '测试' : '否');
      tr.append($("<td></td>").append($badge));
      tr.append($("<td></td>").text(r.scan_count));
      tr.append($("<td></td>").text(r.last_scan_time || '-'));
      tr.append($("<td></td>").text(r.last_scan_ip || '-'));
      const $ops = $("<td></td>");
      const $group = $('<div class="btn-group btn-group-sm" role="group"></div>');
      const $del = $('<button class="btn btn-outline-danger" title="删除">删除</button>').click(function(){ deleteCode(r.code) });
      const $toggle = $('<button class="btn btn-outline-warning" title="切换测试状态"></button>').text(r.is_test?'取消测试':'设为测试').click(function(){ updateCode(r.code, {is_test: !r.is_test}) });
      const $reset = $('<button class="btn btn-outline-secondary" title="重置次数">重置</button>').click(function(){ updateCode(r.code, {scan_count: 0}) });
      $group.append($del).append($toggle).append($reset);
      $ops.append($group);
      tr.append($ops);
      $tbody.append(tr);
    });
    if ($tbody.children().length === 0) {
      const tr = $("<tr></tr>");
      const td = $('<td colspan="6" style="text-align:center; color:rgba(0,0,0,0.55);">暂无数据</td>');
      tr.append(td);
      $tbody.append(tr);
    }
  }
  function loadCodes(){
    $.ajax("/api/antifake/codes", {method:"GET"}).done(function(res){
      renderCodes(res && res.list ? res.list : []);
    });
  }
  function addCode(){
    const code = ($("#new-code").val()||'').trim();
    const is_test = $("#new-is-test").is(":checked");
    $.ajax("/api/antifake/codes", {
      method: "POST",
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      data: JSON.stringify({code, is_test}),
    }).done(function(){
      $("#new-code").val('');
      $("#new-is-test").prop("checked", false);
      loadCodes();
    });
  }
  function updateCode(code, payload){
    $.ajax("/api/antifake/codes/"+code, {
      method: "PUT",
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      data: JSON.stringify(payload||{}),
    }).done(function(){
      loadCodes();
    });
  }
  function deleteCode(code){
    $.ajax("/api/antifake/codes/"+code, {method:"DELETE"}).done(function(){
      loadCodes();
    });
  }
  $(function(){
    fillNow();
    loadCodes();
  });
</script>

</html>
